<% if user_signed_in? %>




<h4><%= @employee.name %> <%= @employee.first_name %><br>
Status: <%= @employee.status %>
Code de validation: <%= @employee.validation_code %><h4>

  <%= Date.today.strftime("%A %d/%m/%Y") %><br>

    <% @employee.sorties_today.each do |sortie| %>

    <%= @employee.entrees.where("created_at < ?", sortie.created_at).last.created_at.strftime("%H:%M") %>

      <%= sortie.created_at.strftime("%H:%M") %>

      <%= @employee.display_duration(sortie) %>

  	<% end %><br>

   <%= Date.current.yesterday.strftime("%A %d/%m/%Y") %><br>

    <% @employee.attendances.where(:content => "sortie",:created_at => (1.day.ago.beginning_of_day..1.day.ago.end_of_day)).each do |sortie| %>
  
          
    <%= @employee.attendances.where("created_at < ?", sortie.created_at).where(:content => "entree").last.created_at.strftime("%H:%M") %>

    <%= sortie.created_at.strftime("%H:%M") %>

    <%= @employee.display_duration(sortie) %>

    <% end %><br>

  <%= 2.days.ago.strftime("%A %d/%m/%Y") %><br>

    
      <% @employee.attendances.sortie.two_days_before.each do |sortie| %>
    
            
      <%= @employee.attendances.entree.where("created_at < ?", sortie.created_at).last.created_at.strftime("%H:%M") %>

      <%= sortie.created_at.strftime("%H:%M") %>

      <%= @employee.display_duration(sortie) %>
    

      <% end %><br>
    
  <%= 3.days.ago.strftime("%A %d/%m/%Y") %><br>
    
      	<% @employee.attendances.where(:content => "sortie",:created_at => (3.days.ago.beginning_of_day..3.days.ago.end_of_day)).each do |sortie| %>
            
            <%= @employee.attendances.where("created_at < ?", sortie.created_at).where(:content => "entree").last.created_at.strftime("%H:%M") %>

            <%= sortie.created_at.strftime("%H:%M") %>

            <%= @employee.display_duration(sortie) %><br>

        <% end %><br>    

	<%= 4.days.ago.strftime("%A %d/%m/%Y") %><br>
    
      	<% @employee.attendances.where(:content => "sortie",:created_at => (4.days.ago.beginning_of_day..4.days.ago.end_of_day)).each do |sortie| %>
            
            <%= @employee.attendances.where("created_at < ?", sortie.created_at).where(:content => "entree").last.created_at.strftime("%H:%M") %>

            <%= sortie.created_at.strftime("%H:%M") %>

            <%= @employee.display_duration(sortie) %><br>

        <% end %><br>    

	<%= 5.days.ago.strftime("%A %d/%m/%Y") %><br>
    
      	<% @employee.attendances.where(:content => "sortie",:created_at => (5.days.ago.beginning_of_day..5.days.ago.end_of_day)).each do |sortie| %>
            
            <%= @employee.attendances.where("created_at < ?", sortie.created_at).where(:content => "entree").last.created_at.strftime("%H:%M") %>

            <%= sortie.created_at.strftime("%H:%M") %>

            <%= @employee.display_duration(sortie) %><br>

        <% end %><br>

	<%= 6.days.ago.strftime("%A %d/%m/%Y") %><br>
    
      	<% @employee.attendances.where(:content => "sortie",:created_at => (6.days.ago.beginning_of_day..6.days.ago.end_of_day)).each do |sortie| %>
            
            <%= @employee.attendances.where("created_at < ?", sortie.created_at).where(:content => "entree").last.created_at.strftime("%H:%M") %>

            <%= sortie.created_at.strftime("%H:%M") %>

            <%= @employee.display_duration(sortie) %><br>

        <% end %><br>

    <%= 7.days.ago.strftime("%A %d/%m/%Y") %><br>
    
      	<% @employee.attendances.where(:content => "sortie",:created_at => (7.days.ago.beginning_of_day..7.days.ago.end_of_day)).each do |sortie| %>
            
            <%= @employee.attendances.where("created_at < ?", sortie.created_at).where(:content => "entree").last.created_at.strftime("%H:%M") %>

            <%= sortie.created_at.strftime("%H:%M") %>

            <%= @employee.display_duration(sortie) %><br>

        <% end %><br>

<% else %>

<div class="jumbotron">

<p>
  <strong>Nom:</strong>
  <%= @employee.name %>
</p>

<p>
  <strong>Prénom:</strong>
  <%= @employee.first_name %>
</p>

<p>
  <strong>Statut:</strong>
  <%= @employee.status %>
</p>

<p>
  <strong><%= @employee.last_move_content %> le <%= @employee.last_move_day %> <%= @employee.last_move_time.strftime("%d/%m/%Y") %> à <%= @employee.last_move_time.strftime("%H:%M") %></strong>
 </p>

</div>

<h1 class="text-center">
<%= Time.now.strftime("%A %d/%m/%Y") %><br>
<%= Time.now.strftime("%H:%M") %>
</h1>

<h3 class="text-center">

	<% if @employee.attendances.any? && @employee.attendances.last.content == "entree" %>
	<%# Si utilisateur déjà in, bouton sortie %>

		<%= simple_form_for(@attendance) do |f| %>
		  <%= f.error_notification %>    

		  	<%= f.hidden_field :employee_id, :value => @employee.id %>
		  	<%= f.hidden_field :validation_code, :value => @employee.validation_code %>
		    <%= f.hidden_field :content, :value => "sortie" %>	 

		  <div class="form-actions">
		    <%= f.submit "Sortie", class: "btn btn-success btn-lg" %>
		  </div>

		<% end %><br> 
		<strong><%= @employee.first_name %>, pour l'instant, vous êtes dedans.</strong>

	<% else %>
	<%# Si utilisateur out, bouton entrée %>
		<%= simple_form_for(@attendance) do |f| %>
		  <%= f.error_notification %>	
		  	<%= f.hidden_field :employee_id, :value => @employee.id %>    
		    <%= f.hidden_field :content, :value => "entree" %>	  
		  <div class="form-actions">
		    <%= f.submit "Entrée", class: "btn btn-success btn-lg" %>
		  </div>
		<% end %><br> 
		<strong><%= @employee.first_name %>, pour l'instant, vous êtes dehors.</strong>

	<% end %>

</h3>
<p>
<h4 class="text-center">
<%= link_to 'Retour', employees_path, class: "btn btn-warning btn-lg" %>
</h4>
</p>

<% end %>